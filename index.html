<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sistema Integrado de Consulta de Servidores - DGF</title>

<style>
* { margin:0; padding:0; box-sizing:border-box; }
body { font-family:'Segoe UI', sans-serif; background:#f4f6f9; }

.topbar {
    background:#002b5c;
    color:white;
    padding:18px 30px;
    font-size:18px;
    font-weight:600;
}
.topbar small { display:block; font-size:12px; opacity:0.8; }

.gold-line { height:4px; background:#c9a227; }

.main {
    display:flex;
    justify-content:center;
    align-items:center;
    height:calc(100vh - 110px);
}

.container {
    background:white;
    padding:40px;
    border-radius:12px;
    width:460px;
    box-shadow:0 15px 40px rgba(0,0,0,0.1);
}

.titulo-area { text-align:center; margin-bottom:25px; }
.logo-titulo { height:70px; margin-bottom:10px; }

h2 { color:#002b5c; font-size:18px; }

input {
    width:100%;
    padding:12px;
    border-radius:6px;
    border:1px solid #ccc;
    margin-bottom:12px;
    font-size:14px;
}

button {
    width:100%;
    padding:12px;
    border-radius:6px;
    border:none;
    background:#003366;
    color:white;
    font-weight:600;
    cursor:pointer;
    margin-bottom:8px;
    transition:0.2s;
}

button:hover { background:#002244; }
.secondary { background:#5c6f82; }
.secondary:hover { background:#4b5c6b; }
.logout { background:#8b0000; }
.logout:hover { background:#6e0000; }

.hidden { display:none; }

.response {
    margin-top:15px;
    background:#f1f3f6;
    padding:15px;
    border-radius:8px;
    min-height:60px;
    font-size:14px;
    border-left:4px solid #002b5c;
}

.footer {
    text-align:center;
    padding:15px;
    font-size:12px;
    color:#555;
    background:#e9edf2;
}
</style>
</head>

<body>

<div class="topbar">
    Secretaria Estadual de Pernambuco - Diretoria Geral de Finan√ßas
    <small>Sistema Interno Oficial</small>
</div>

<div class="gold-line"></div>

<div class="main">
<div class="container">

<div id="loginArea">
    <div class="titulo-area">
        <img src="brasao-dgf.png" alt="Bras√£o DGF" class="logo-titulo">
        <h2>Sistema Integrado de Consulta de Servidores - DGF</h2>
    </div>
    <input type="text" id="usuario" placeholder="Usu√°rio institucional">
    <input type="password" id="senha" placeholder="Senha">
    <button onclick="login()">Entrar no Sistema</button>
</div>

<div id="sistemaArea" class="hidden">
    <h2>Assistente de Consulta</h2>
    <input type="text" id="pergunta" placeholder="Digite nome ou consulta funcional...">
    <button onclick="consultar()">Consultar</button>
    <button class="secondary" onclick="limpar()">Nova Consulta</button>
    <button class="logout" onclick="logout()">Encerrar Sess√£o</button>
    <div class="response" id="resposta"></div>
</div>

</div>
</div>

<div class="footer">
¬© 2026 - Diretoria Geral de Finan√ßas (DGF) ‚Ä¢ Uso interno e restrito
</div>

<script>
document.addEventListener("DOMContentLoaded", function() {

    const WEBHOOK_URL = "https://script.google.com/macros/s/AKfycbxA3anDchuSGHN-E0d6dybvAEFI-NYWK1xIKSoz22Zd8CHpADzzNHfzvd_uvlqqigYZ/exec";
    const TEMPO_EXPIRACAO = 30 * 60 * 1000;

    const usuarios = [
        { usuario: "admin", senha: "1234" },
        { usuario: "rh", senha: "rh123" }
    ];

    const loginArea = document.getElementById("loginArea");
    const sistemaArea = document.getElementById("sistemaArea");
    const usuarioInput = document.getElementById("usuario");
    const senhaInput = document.getElementById("senha");
    const perguntaInput = document.getElementById("pergunta");
    const respostaDiv = document.getElementById("resposta");

    function verificarSessao() {
        const tempoLogin = localStorage.getItem("tempoLogin");
        if (!tempoLogin) return false;
        const agora = Date.now();
        return (agora - parseInt(tempoLogin)) <= TEMPO_EXPIRACAO;
    }

    if (localStorage.getItem("logado") === "true" && verificarSessao()) {
        loginArea.classList.add("hidden");
        sistemaArea.classList.remove("hidden");
    }

    window.login = function() {
        const user = usuarioInput.value.trim();
        const pass = senhaInput.value.trim();
        const autorizado = usuarios.find(u => u.usuario === user && u.senha === pass);

        if (autorizado) {
            localStorage.setItem("logado", "true");
            localStorage.setItem("tempoLogin", Date.now());
            loginArea.classList.add("hidden");
            sistemaArea.classList.remove("hidden");
            perguntaInput.focus();
        } else {
            alert("Usu√°rio ou senha inv√°lidos.");
        }
    }

    window.logout = function() {
        localStorage.removeItem("logado");
        localStorage.removeItem("tempoLogin");
        location.reload();
    }

    window.consultar = async function() {

        if (!verificarSessao()) {
            alert("Sess√£o expirada.");
            logout();
            return;
        }

        let perguntaOriginal = perguntaInput.value.trim();
        let pergunta = perguntaOriginal.toLowerCase();
        if (!pergunta) { respostaDiv.innerHTML="Digite um nome ou consulta."; return; }

        respostaDiv.innerHTML = "Consultando...";
        pergunta = pergunta.replace(/[?.,]/g, "");

        let campo = "completo";
        if (pergunta.includes("chefe")) campo = "chefe";
        else if (pergunta.includes("empresa")) campo = "empresa";
        else if (pergunta.includes("setor")) campo = "setor";
        else if (pergunta.includes("cargo")) campo = "cargo";
        else if (pergunta.includes("status")) campo = "status";

        let nome = "";
        if (pergunta.includes(" de ")) nome = pergunta.split(" de ")[1].trim();
        else if (pergunta.includes(" do ")) nome = pergunta.split(" do ")[1].trim();
        else if (pergunta.includes(" da ")) nome = pergunta.split(" da ")[1].trim();
        else nome = pergunta;

        try {
            const response = await fetch(WEBHOOK_URL + "?nome=");
            const data = await response.json();

            if (!data || data.length === 0) {
                respostaDiv.innerHTML = "Nenhum registro encontrado.";
                return;
            }

            let resultados = data;
            if (nome) resultados = data.filter(f => f.nome.toLowerCase().includes(nome));

            if (resultados.length === 0) {
                respostaDiv.innerHTML = "Nenhum registro encontrado.";
                return;
            }

            let html = "";
            resultados.forEach(func => {
                if (campo !== "completo") {
                    html += `O ${campo} de <strong>${func.nome}</strong> √© <strong>${func[campo]}</strong>.<br><br>`;
                } else {
                    html += `
                    <strong>üë§ ${func.nome}</strong><br>
                    üè¢ Setor: ${func.setor}<br>
                    üíº Cargo: ${func.cargo}<br>
                    üë®‚Äçüíº Chefe: ${func.chefe}<br>
                    üè¨ Empresa: ${func.empresa}<br>
                    üìä Status: ${func.status}
                    <hr>`;
                }
            });

            respostaDiv.innerHTML = `üîé Encontrei ${resultados.length} resultado(s):<br><br>` + html;

        } catch (error) {
            respostaDiv.innerHTML = "Erro ao consultar sistema.";
        }
    }

    window.limpar = function() {
        perguntaInput.value = "";
        respostaDiv.innerHTML = "";
        perguntaInput.focus();
    }

});
</script>

</body>
</html>

