<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sistema Integrado de Consulta de Servidores - DGF</title>

<style>
/* ... (Seu CSS original mantido) ... */
* { margin: 0; padding: 0; box-sizing: border-box; }
body { font-family: 'Segoe UI', sans-serif; background: #f4f6f9; }
.topbar { background: #002b5c; color: white; padding: 18px 30px; font-size: 18px; font-weight: 600; }
.topbar small { display: block; font-size: 12px; opacity: 0.8; }
.gold-line { height: 4px; background: #c9a227; }
.main { display: flex; justify-content: center; align-items: center; height: calc(100vh - 110px); }
.container { background: white; padding: 40px; border-radius: 12px; width: 460px; box-shadow: 0 15px 40px rgba(0,0,0,0.1); }
.titulo-area { text-align: center; margin-bottom: 25px; }
.logo-titulo { height: 70px; margin-bottom: 10px; }
h2 { color: #002b5c; font-size: 18px; margin-bottom: 15px; }
input { width: 100%; padding: 12px; border-radius: 6px; border: 1px solid #ccc; margin-bottom: 12px; font-size: 14px; }
button { width: 100%; padding: 12px; border-radius: 6px; border: none; background: #003366; color: white; font-weight: 600; cursor: pointer; margin-bottom: 8px; transition: 0.2s; }
button:hover { background: #002244; }
.secondary { background: #5c6f82; }
.secondary:hover { background: #4b5c6b; }
.logout { background: #8b0000; }
.logout:hover { background: #6e0000; }
.hidden { display: none; }
.response { margin-top: 15px; background: #f1f3f6; padding: 15px; border-radius: 8px; min-height: 60px; font-size: 14px; border-left: 4px solid #002b5c; height: 250px; overflow-y: auto; }
.footer { text-align: center; padding: 15px; font-size: 12px; color: #555; background: #e9edf2; }

/* ‚úÖ NOVOS ESTILOS PARA O OLHINHO E TROCA DE SENHA */
.password-container { position: relative; width: 100%; }
.toggle-password {
    position: absolute;
    right: 10px;
    top: 12px;
    cursor: pointer;
    color: #666;
    user-select: none;
}
.alert-info {
    background: #e1f5fe;
    color: #01579b;
    padding: 10px;
    border-radius: 5px;
    font-size: 13px;
    margin-bottom: 15px;
    border-left: 4px solid #0288d1;
}
</style>
</head>

<body>

<div class="topbar">
Secretaria Estadual de Pernambuco - Diretoria Geral de Finan√ßas
<small>Sistema Interno Oficial</small>
</div>
<div class="gold-line"></div>

<div class="main">
    <div class="container">

        <div id="loginArea">
            <div class="titulo-area">
                <img src="brasao-dgf.png" alt="Bras√£o DGF" class="logo-titulo">
                <h2>Sistema Integrado de Consulta de Servidores</h2>
            </div>
            <input type="text" id="usuario" placeholder="Usu√°rio institucional">
            
            <div class="password-container">
                <input type="password" id="senha" placeholder="Senha">
                <span class="toggle-password" onclick="toggleView('senha')">üëÅÔ∏è</span>
            </div>
            
            <button onclick="login()">Entrar no Sistema</button>
        </div>

        <div id="trocaSenhaArea" class="hidden">
            <h2>üîí Primeiro Acesso</h2>
            <p class="alert-info">Por seguran√ßa, voc√™ precisa alterar sua senha inicial para continuar.</p>
            
            <div class="password-container">
                <input type="password" id="novaSenha" placeholder="Nova senha">
                <span class="toggle-password" onclick="toggleView('novaSenha')">üëÅÔ∏è</span>
            </div>
            
            <div class="password-container">
                <input type="password" id="confirmaSenha" placeholder="Confirme a nova senha">
                <span class="toggle-password" onclick="toggleView('confirmaSenha')">üëÅÔ∏è</span>
            </div>
            
            <button onclick="salvarNovaSenha()">Atualizar Senha e Entrar</button>
        </div>

        <div id="sistemaArea" class="hidden">
            <h2>Assistente de Consulta</h2>
            <input type="text" id="pergunta" placeholder="Ex: equipe de Lourdes ou quantos na GC">
            <button onclick="consultar()">Consultar</button>
            <button class="secondary" onclick="limpar()">Nova Consulta</button>
            <button class="logout" onclick="logout()">Encerrar Sess√£o</button>
            <div class="response" id="resposta"></div>
        </div>

    </div>
</div>

<div class="footer">
¬© 2026 - Diretoria Geral de Finan√ßas (DGF) ‚Ä¢ Uso interno e restrito
</div>

<script>
document.addEventListener("DOMContentLoaded", function() {

    const WEBHOOK_URL = "https://script.google.com/macros/s/AKfycbyA3fOOroxsfCTt1Ar_II3SZn_hHv-CLeP5Voiv5FPKOuGS4n330_f48A43lECINVc/exec";
    const TEMPO_EXPIRACAO = 30 * 60 * 1000;

    // Base de usu√°rios (Simulando banco de dados local com localStorage)
    const usuariosPadrao = [
        { usuario: "admin", senha: "1234", primeiroAcesso: true },
        { usuario: "mauro", senha: "0000", primeiroAcesso: true }
    ];

    // Inicializa os usu√°rios no navegador se for a primeira vez
    if (!localStorage.getItem("db_usuarios")) {
        localStorage.setItem("db_usuarios", JSON.stringify(usuariosPadrao));
    }

    const loginArea = document.getElementById("loginArea");
    const trocaSenhaArea = document.getElementById("trocaSenhaArea");
    const sistemaArea = document.getElementById("sistemaArea");
    const usuarioInput = document.getElementById("usuario");
    const senhaInput = document.getElementById("senha");
    const perguntaInput = document.getElementById("pergunta");
    const respostaDiv = document.getElementById("resposta");

    // ‚úÖ FUN√á√ÉO OLHINHO
    window.toggleView = function(id) {
        const input = document.getElementById(id);
        input.type = input.type === "password" ? "text" : "password";
    }

    // ‚úÖ LOGIN COM L√ìGICA DE PRIMEIRO ACESSO
    window.login = function() {
        const db = JSON.parse(localStorage.getItem("db_usuarios"));
        const user = db.find(u => u.usuario === usuarioInput.value.trim() && u.senha === senhaInput.value.trim());

        if (user) {
            if (user.primeiroAcesso) {
                localStorage.setItem("usuarioTemporario", user.usuario);
                loginArea.classList.add("hidden");
                trocaSenhaArea.classList.remove("hidden");
            } else {
                iniciarSessao();
            }
        } else {
            alert("Usu√°rio ou senha inv√°lidos.");
        }
    }

    // ‚úÖ SALVAR NOVA SENHA
    window.salvarNovaSenha = function() {
        const nova = document.getElementById("novaSenha").value;
        const confirma = document.getElementById("confirmaSenha").value;
        const usuarioAtual = localStorage.getItem("usuarioTemporario");

        if (nova.length < 4) return alert("A senha deve ter pelo menos 4 caracteres.");
        if (nova !== confirma) return alert("As senhas n√£o coincidem.");

        let db = JSON.parse(localStorage.getItem("db_usuarios"));
        let index = db.findIndex(u => u.usuario === usuarioAtual);
        
        db[index].senha = nova;
        db[index].primeiroAcesso = false;
        
        localStorage.setItem("db_usuarios", JSON.stringify(db));
        localStorage.removeItem("usuarioTemporario");
        
        alert("Senha atualizada com sucesso!");
        iniciarSessao();
    }

    function iniciarSessao() {
        localStorage.setItem("logado", "true");
        localStorage.setItem("tempoLogin", Date.now());
        loginArea.classList.add("hidden");
        trocaSenhaArea.classList.add("hidden");
        sistemaArea.classList.remove("hidden");
    }

    window.logout = function() {
        localStorage.removeItem("logado");
        localStorage.removeItem("tempoLogin");
        location.reload();
    }

    /* --- RESTANTE DA LOGICA DE CONSULTA (MANTIDA) --- */
    let paginaAtual = 1;
    const itensPorPagina = 10;
    let resultadosGlobais = [];

    window.renderizarPagina = function() {
        const inicio = (paginaAtual - 1) * itensPorPagina;
        const fim = inicio + itensPorPagina;
        const pagina = resultadosGlobais.slice(inicio, fim);
        const totalPaginas = Math.ceil(resultadosGlobais.length / itensPorPagina);

        let html = `<strong>${resultadosGlobais.length} resultado(s)</strong><br>`;
        html += `<small>P√°gina ${paginaAtual} de ${totalPaginas}</small><br><br>`;

        pagina.forEach(f => {
            html += `<div style="margin-bottom:10px; border-bottom:1px solid #ddd; padding-bottom:5px;">
            <strong>üë§ ${f.nome}</strong><br>
            üè¢ Setor: ${f.setor} | üíº Cargo: ${f.cargo}
            </div>`;
        });

        html += `<div style="text-align:center; margin-top:10px;">`;
        if (paginaAtual > 1) html += `<button style="width:50px" onclick="paginaAnterior()">‚¨ÖÔ∏è</button> `;
        if (fim < resultadosGlobais.length) html += `<button style="width:50px" onclick="proximaPagina()">‚û°Ô∏è</button>`;
        html += `</div>`;
        respostaDiv.innerHTML = html;
    }

    window.proximaPagina = () => { paginaAtual++; renderizarPagina(); }
    window.paginaAnterior = () => { paginaAtual--; renderizarPagina(); }

    window.consultar = async function() {
        const p = perguntaInput.value.toLowerCase();
        respostaDiv.innerHTML = "Buscando...";
        try {
            const response = await fetch(WEBHOOK_URL);
            const data = await response.json();
            // L√≥gica simplificada para exemplo (voc√™ pode manter sua extra√ß√£o de termos aqui)
            resultadosGlobais = data.filter(f => f.nome.toLowerCase().includes(p.split(" ").pop()) || f.setor.toLowerCase().includes(p.split(" ").pop()));
            paginaAtual = 1;
            renderizarPagina();
        } catch (e) { respostaDiv.innerHTML = "Erro ao consultar dados."; }
    }

    window.limpar = function() {
        perguntaInput.value="";
        respostaDiv.innerHTML="";
        perguntaInput.focus();
    }
});
</script>
</body>
</html>
