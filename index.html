<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sistema Integrado de Consulta de Servidores - DGF</title>

<style>
* { margin: 0; padding: 0; box-sizing: border-box; }

body { font-family: 'Segoe UI', sans-serif; background: #f4f6f9; }

.topbar { background: #002b5c; color: white; padding: 18px 30px; font-size: 18px; font-weight: 600; }
.topbar small { display: block; font-size: 12px; opacity: 0.8; }

.gold-line { height: 4px; background: #c9a227; }

.main { display: flex; justify-content: center; align-items: center; height: calc(100vh - 110px); }

.container {
background: white;
padding: 40px;
border-radius: 12px;
width: 460px;
box-shadow: 0 15px 40px rgba(0,0,0,0.1);
}

.titulo-area { text-align: center; margin-bottom: 25px; }

.logo-titulo { height: 70px; margin-bottom: 10px; }

h2 { color: #002b5c; font-size: 18px; }

input {
width: 100%;
padding: 12px;
border-radius: 6px;
border: 1px solid #ccc;
margin-bottom: 12px;
font-size: 14px;
}

button {
width: 100%;
padding: 12px;
border-radius: 6px;
border: none;
background: #003366;
color: white;
font-weight: 600;
cursor: pointer;
margin-bottom: 8px;
transition: 0.2s;
}

button:hover { background: #002244; }

.secondary { background: #5c6f82; }
.secondary:hover { background: #4b5c6b; }

.logout { background: #8b0000; }
.logout:hover { background: #6e0000; }

.hidden { display: none; }

.response {
margin-top: 15px;
background: #f1f3f6;
padding: 15px;
border-radius: 8px;
min-height: 60px;
font-size: 14px;
border-left: 4px solid #002b5c;
}

.footer {
text-align: center;
padding: 15px;
font-size: 12px;
color: #555;
background: #e9edf2;
}
</style>
</head>

<body>

<div class="topbar">
Secretaria Estadual de Pernambuco - Diretoria Geral de Finan√ßas
<small>Sistema Interno Oficial</small>
</div>

<div class="gold-line"></div>

<div class="main">
<div class="container">

<div id="loginArea">
<div class="titulo-area">
<img src="brasao-dgf.png" alt="Bras√£o DGF" class="logo-titulo">
<h2>Sistema Integrado de Consulta de Servidores - DGF</h2>
</div>

<input type="text" id="usuario" placeholder="Usu√°rio institucional">
<input type="password" id="senha" placeholder="Senha">
<button onclick="login()">Entrar no Sistema</button>
</div>

<div id="sistemaArea" class="hidden">
<h2>Assistente de Consulta</h2>

<input type="text" id="pergunta" placeholder="Ex: quem √© da equipe de Lourdes?">
<button onclick="consultar()">Consultar</button>
<button class="secondary" onclick="limpar()">Nova Consulta</button>
<button class="logout" onclick="logout()">Encerrar Sess√£o</button>

<div class="response" id="resposta"></div>
</div>

</div>
</div>

<div class="footer">
¬© 2026 - Diretoria Geral de Finan√ßas (DGF) ‚Ä¢ Uso interno e restrito
</div>

<script>
document.addEventListener("DOMContentLoaded", function() {

const WEBHOOK_URL = "https://script.google.com/macros/s/AKfycbyA3fOOroxsfCTt1Ar_II3SZn_hHv-CLeP5Voiv5FPKOuGS4n330_f48A43lECINVc/exec";
const TEMPO_EXPIRACAO = 30 * 60 * 1000;

const usuarios = [
{ usuario: "admin", senha: "1234" },
{ usuario: "rh", senha: "rh123" }
];

const loginArea = document.getElementById("loginArea");
const sistemaArea = document.getElementById("sistemaArea");
const usuarioInput = document.getElementById("usuario");
const senhaInput = document.getElementById("senha");
const perguntaInput = document.getElementById("pergunta");
const respostaDiv = document.getElementById("resposta");

/* ===== NORMALIZA√á√ÉO INTELIGENTE ===== */

function normalizar(txt) {
return txt.toLowerCase()
.normalize("NFD")
.replace(/[\u0300-\u036f]/g, "")
.trim();
}

const sinonimos = {
"rm": ["rm", "empresa rm", "rm ltda"],
"dgf": ["dgf", "diretoria geral de financas"]
};

function equivalente(a, b) {
a = normalizar(a);
b = normalizar(b);
if (a === b) return true;

for (let chave in sinonimos) {
if (sinonimos[chave].includes(a) && sinonimos[chave].includes(b))
return true;
}
return false;
}

/* ===== LOGIN ===== */

usuarioInput.addEventListener("keydown", e => { if (e.key === "Enter") login(); });
senhaInput.addEventListener("keydown", e => { if (e.key === "Enter") login(); });
perguntaInput.addEventListener("keydown", e => { if (e.key === "Enter") consultar(); });

function verificarSessao() {
const tempoLogin = localStorage.getItem("tempoLogin");
if (!tempoLogin) return false;
return (Date.now() - parseInt(tempoLogin)) <= TEMPO_EXPIRACAO;
}

if (localStorage.getItem("logado") === "true" && verificarSessao()) {
loginArea.classList.add("hidden");
sistemaArea.classList.remove("hidden");
}

window.login = function() {
const autorizado = usuarios.find(u =>
u.usuario === usuarioInput.value.trim() &&
u.senha === senhaInput.value.trim()
);
if (autorizado) {
localStorage.setItem("logado", "true");
localStorage.setItem("tempoLogin", Date.now());
loginArea.classList.add("hidden");
sistemaArea.classList.remove("hidden");
perguntaInput.focus();
} else alert("Usu√°rio ou senha inv√°lidos.");
}

window.logout = function() {
localStorage.clear();
location.reload();
}

/* ===== CONSULTA INTELIGENTE ===== */

function extrairTermo(frase, chaves) {
for (let c of chaves) {
if (frase.includes(c)) return frase.split(c)[1]?.trim();
}
return null;
}

window.consultar = async function() {

if (!verificarSessao()) { logout(); return; }

let pergunta = normalizar(perguntaInput.value);
if (!pergunta) return respostaDiv.innerHTML = "Digite uma pergunta.";

respostaDiv.innerHTML = "Consultando...";
pergunta = pergunta.replace(/[?.,]/g, "");

let tipo = "nome";
let termo = extrairTermo(pergunta, ["equipe de","time de","chefiados por"]);

if (termo) tipo = "equipe";

if (!termo) {
termo = extrairTermo(pergunta, ["empresa","da empresa"]);
if (termo) tipo = "empresa";
}

if (!termo) {
termo = extrairTermo(pergunta, ["setor","do setor"]);
if (termo) tipo = "setor";
}

if (pergunta.includes("quantos") || pergunta.includes("quantas")) {
tipo = "contagem";
termo = termo || pergunta.split(" ").pop();
}

if (pergunta.includes("estatistica") || pergunta.includes("resumo")) {
tipo = "estatistica";
}

if (!termo && tipo === "nome")
termo = pergunta.split(" ").pop();

const response = await fetch(WEBHOOK_URL);
const data = await response.json();

let resultados = [];

if (tipo === "equipe")
resultados = data.filter(f => equivalente(f.chefe, termo));

else if (tipo === "empresa")
resultados = data.filter(f => equivalente(f.empresa, termo));

else if (tipo === "setor")
resultados = data.filter(f => equivalente(f.setor, termo));

else if (tipo === "contagem") {
resultados = data.filter(f =>
equivalente(f.setor, termo) ||
equivalente(f.empresa, termo) ||
equivalente(f.chefe, termo)
);
return respostaDiv.innerHTML = `Total encontrado: <strong>${resultados.length}</strong>`;
}

else if (tipo === "estatistica") {

let setores={}, empresas={};
data.forEach(f=>{
setores[f.setor]=(setores[f.setor]||0)+1;
empresas[f.empresa]=(empresas[f.empresa]||0)+1;
});

let html="<strong>Resumo Estat√≠stico</strong><br><br><b>Por setor:</b><br>";
for(let s in setores) html+=`${s}: ${setores[s]}<br>`;
html+="<br><b>Por empresa:</b><br>";
for(let e in empresas) html+=`${e}: ${empresas[e]}<br>`;

return respostaDiv.innerHTML=html;
}

else resultados = data.filter(f => normalizar(f.nome).includes(termo));

if (!resultados.length)
return respostaDiv.innerHTML="Nenhum registro encontrado.";

let html=`<strong>${resultados.length} resultado(s)</strong><br><br>`;

resultados.forEach(f=>{
html+=`
<div style="margin-bottom:12px;">
<strong>üë§ ${f.nome}</strong><br>
üè¢ Setor: ${f.setor}<br>
üíº Cargo: ${f.cargo}<br>
üë®‚Äçüíº Chefe: ${f.chefe}<br>
üè¨ Empresa: ${f.empresa}<br>
üìä Status: ${f.status}
</div>`;
});

respostaDiv.innerHTML=html;
}

window.limpar = function() {
perguntaInput.value="";
respostaDiv.innerHTML="";
perguntaInput.focus();
}

});
</script>

</body>
</html>


