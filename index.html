<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sistema Integrado de Consulta de Servidores - DGF</title>

<style>
* { margin: 0; padding: 0; box-sizing: border-box; }

body {
    font-family: 'Segoe UI', sans-serif;
    background: #f4f6f9;
}

.topbar {
    background: #002b5c;
    color: white;
    padding: 18px 30px;
    font-size: 18px;
    font-weight: 600;
}

.topbar small {
    display: block;
    font-size: 12px;
    opacity: 0.8;
}

.gold-line { height: 4px; background: #c9a227; }

/* ===== NOVO LOGIN ===== */
.login-wrapper {
    display: flex;
    height: calc(100vh - 110px);
}

.login-left {
    flex: 1;
    background: linear-gradient(135deg, #002b5c, #003f88);
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-direction: column;
    text-align: center;
    padding: 40px;
}

.login-left h1 {
    font-size: 28px;
    margin-bottom: 10px;
}

.login-left p {
    font-size: 15px;
    opacity: 0.85;
}

.login-right {
    flex: 1;
    display: flex;
    justify-content: center;
    align-items: center;
}

.main {
    display: flex;
    justify-content: center;
    align-items: center;
    height: calc(100vh - 110px);
}

.container {
    background: white;
    padding: 40px;
    border-radius: 12px;
    width: 460px;
    box-shadow: 0 15px 40px rgba(0,0,0,0.1);
}

.titulo-area { text-align: center; margin-bottom: 25px; }

.logo-titulo {
    height: 70px;
    margin-bottom: 10px;
}

h2 { color: #002b5c; font-size: 18px; }

input {
    width: 100%;
    padding: 12px;
    border-radius: 6px;
    border: 1px solid #ccc;
    margin-bottom: 12px;
    font-size: 14px;
}

button {
    width: 100%;
    padding: 12px;
    border-radius: 6px;
    border: none;
    background: #003366;
    color: white;
    font-weight: 600;
    cursor: pointer;
    margin-bottom: 8px;
    transition: 0.2s;
}

button:hover { background: #002244; }

.secondary { background: #5c6f82; }
.secondary:hover { background: #4b5c6b; }

.logout { background: #8b0000; }
.logout:hover { background: #6e0000; }

.hidden { display: none; }

.response {
    margin-top: 15px;
    background: #f1f3f6;
    padding: 15px;
    border-radius: 8px;
    min-height: 60px;
    font-size: 14px;
    border-left: 4px solid #002b5c;
    height: 250px;
    overflow-y: auto;
}

.footer {
    text-align: center;
    padding: 15px;
    font-size: 12px;
    color: #555;
    background: #e9edf2;
}
</style>
</head>

<body>

<div class="topbar">
Secretaria Estadual de Pernambuco - Diretoria Geral de Finan√ßas
<small>Sistema Interno Oficial</small>
</div>

<div class="gold-line"></div>

<!-- NOVO WRAPPER -->
<div class="login-wrapper">

    <!-- LADO ESQUERDO -->
    <div class="login-left">
        <h1>Sistema DGF</h1>
        <p>Consulta inteligente de servidores</p>
    </div>

    <!-- LADO DIREITO -->
    <div class="login-right">

        <div class="main">
        <div class="container">

        <div id="loginArea">
        <div class="titulo-area">
        <img src="brasao-dgf.png" class="logo-titulo">
        <h2>Sistema Integrado de Consulta de Servidores - DGF</h2>
        </div>

        <input type="text" id="usuario" placeholder="Usu√°rio institucional">
        <input type="password" id="senha" placeholder="Senha">
        <button onclick="login()">Entrar no Sistema</button>
        </div>

        <div id="sistemaArea" class="hidden">
        <h2>Assistente de Consulta</h2>

        <input type="text" id="pergunta" placeholder="Ex: equipe de Lourdes ou quantos na GC">
        <button onclick="consultar()">Consultar</button>
        <button class="secondary" onclick="limpar()">Nova Consulta</button>
        <button class="logout" onclick="logout()">Encerrar Sess√£o</button>

        <div class="response" id="resposta"></div>
        </div>

        </div>
        </div>

    </div>
</div>

<div class="footer">
¬© 2026 - Diretoria Geral de Finan√ßas (DGF) ‚Ä¢ Uso interno e restrito
</div>

<script>
// SEU JS ORIGINAL (100% intacto)
document.addEventListener("DOMContentLoaded", function() {

const WEBHOOK_URL = "https://script.google.com/macros/s/AKfycbyA3fOOroxsfCTt1Ar_II3SZn_hHv-CLeP5Voiv5FPKOuGS4n330_f48A43lECINVc/exec";
const TEMPO_EXPIRACAO = 30 * 60 * 1000;

const usuarios = [
{ usuario: "admin", senha: "1234" },
{ usuario: "mauro", senha: "0000" }
];

const loginArea = document.getElementById("loginArea");
const sistemaArea = document.getElementById("sistemaArea");
const usuarioInput = document.getElementById("usuario");
const senhaInput = document.getElementById("senha");
const perguntaInput = document.getElementById("pergunta");
const respostaDiv = document.getElementById("resposta");

usuarioInput.addEventListener("keydown", e => { if (e.key === "Enter") login(); });
senhaInput.addEventListener("keydown", e => { if (e.key === "Enter") login(); });
perguntaInput.addEventListener("keydown", e => { if (e.key === "Enter") consultar(); });

let paginaAtual = 1;
const itensPorPagina = 10;
let resultadosGlobais = [];

function renderizarPagina() {
    if (!respostaDiv) return;

    const inicio = (paginaAtual - 1) * itensPorPagina;
    const fim = inicio + itensPorPagina;
    const pagina = resultadosGlobais.slice(inicio, fim);
    const totalPaginas = Math.ceil(resultadosGlobais.length / itensPorPagina);

    let html = `<strong>${resultadosGlobais.length} resultado(s)</strong><br>`;
    html += `<small>P√°gina ${paginaAtual} de ${totalPaginas}</small><br><br>`;

    pagina.forEach(f => {
        html += `
        <div style="margin-bottom:10px;">
        <strong>üë§ ${f.nome}</strong><br>
        üè¢ Setor: ${f.setor}<br>
        üíº Cargo: ${f.cargo}<br>
        üë®‚Äçüíº Chefe: ${f.chefe}<br>
        üè¨ Empresa: ${f.empresa}<br>
        üìä Status: ${f.status}
        </div>`;
    });

    html += `<div style="text-align:center;">`;

    if (paginaAtual > 1) html += `<button onclick="paginaAnterior()">‚¨ÖÔ∏è</button>`;
    if (fim < resultadosGlobais.length) html += `<button onclick="proximaPagina()">‚û°Ô∏è</button>`;

    html += `</div>`;

    respostaDiv.innerHTML = html;
}

window.proximaPagina = function() {
    paginaAtual++;
    renderizarPagina();
}

window.paginaAnterior = function() {
    paginaAtual--;
    renderizarPagina();
}

function verificarSessao() {
const tempoLogin = localStorage.getItem("tempoLogin");
if (!tempoLogin) return false;
return (Date.now() - parseInt(tempoLogin)) <= TEMPO_EXPIRACAO;
}

if (localStorage.getItem("logado") === "true" && verificarSessao()) {
loginArea.classList.add("hidden");
sistemaArea.classList.remove("hidden");
}

window.login = function() {
const autorizado = usuarios.find(u =>
u.usuario === usuarioInput.value.trim() &&
u.senha === senhaInput.value.trim()
);

if (autorizado) {
localStorage.setItem("logado", "true");
localStorage.setItem("tempoLogin", Date.now());
loginArea.classList.add("hidden");
sistemaArea.classList.remove("hidden");
perguntaInput.focus();
} else alert("Usu√°rio ou senha inv√°lidos.");
}

window.logout = function() {
localStorage.clear();
location.reload();
}

function extrairTermo(frase, chaves) {
for (let c of chaves) {
if (frase.includes(c)) return frase.split(c)[1]?.trim();
}
return null;
}

window.consultar = async function() {

if (!verificarSessao()) { logout(); return; }

let pergunta = perguntaInput.value.trim().toLowerCase();
if (!pergunta) return respostaDiv.innerHTML = "Digite uma pergunta.";

respostaDiv.innerHTML = "Consultando...";
pergunta = pergunta.replace(/[?.,]/g, "");

let tipo = "nome";
let termo = null;

if (pergunta.includes("equipe") || pergunta.includes("time")) {
tipo = "equipe";
termo = extrairTermo(pergunta, ["equipe de","time de"]);
}

if (!termo && (pergunta.includes("funcionarios") || pergunta.includes("funcion√°rios"))) {
tipo = "empresa";
termo = extrairTermo(pergunta, ["funcionarios da","funcion√°rios da"]);
}

if (!termo && pergunta.includes("setor")) {
tipo = "setor_nome";
termo = extrairTermo(pergunta, ["setor de","qual setor","do setor"]);
}

if (!termo && pergunta.includes("empresa")) {
tipo = "empresa_nome";
termo = extrairTermo(pergunta, ["empresa de","da empresa","trabalha"]);
}

if (!termo && pergunta.includes("cargo")) {
tipo = "cargo_nome";
termo = extrairTermo(pergunta, ["cargo de"]);
}

if (!termo && pergunta.includes("chefe")) {
tipo = "chefe";
termo = extrairTermo(pergunta, ["chefe de","chefe do"]);
}

if (pergunta.includes("quantos") || pergunta.includes("quantas")) {
tipo = "contagem";

termo = extrairTermo(pergunta, [
"quantos tem na",
"quantos tem no",
"quantos na",
"quantas na",
"quantas no"
]);

if (!termo) termo = pergunta.split(" ").pop();
}

if (!termo) termo = pergunta.split(" ").pop();

const response = await fetch(WEBHOOK_URL);
const data = await response.json();

let resultados = [];

if (tipo === "chefe") {
let pessoas = data.filter(f => f.nome.toLowerCase().includes(termo));
if (!pessoas.length) return respostaDiv.innerHTML = "Pessoa n√£o encontrada.";

let html = `<strong>${pessoas.length} resultado(s)</strong><br><br>`;
pessoas.forEach(p => {
html += `<div style="margin-bottom:12px;">üë§ <strong>${p.nome}</strong><br>üë®‚Äçüíº Chefe: ${p.chefe}</div>`;
});
return respostaDiv.innerHTML = html;
}

if (tipo === "setor_nome") {
let pessoas = data.filter(f => f.nome.toLowerCase().includes(termo));
if (!pessoas.length) return respostaDiv.innerHTML = "Pessoa n√£o encontrada.";

let html = "";
pessoas.forEach(p => {
html += `üè¢ ${p.nome} est√° no setor: <strong>${p.setor}</strong><br>`;
});
return respostaDiv.innerHTML = html;
}

if (tipo === "empresa_nome") {
let pessoas = data.filter(f => f.nome.toLowerCase().includes(termo));
if (!pessoas.length) return respostaDiv.innerHTML = "Pessoa n√£o encontrada.";

let html = "";
pessoas.forEach(p => {
html += `üè¨ ${p.nome} trabalha na empresa: <strong>${p.empresa}</strong><br>`;
});
return respostaDiv.innerHTML = html;
}

if (tipo === "cargo_nome") {
let pessoas = data.filter(f => f.nome.toLowerCase().includes(termo));
if (!pessoas.length) return respostaDiv.innerHTML = "Pessoa n√£o encontrada.";

let html = "";
pessoas.forEach(p => {
html += `üíº Cargo de ${p.nome}: <strong>${p.cargo}</strong><br>`;
});
return respostaDiv.innerHTML = html;
}

if (tipo === "equipe") {
resultados = data.filter(f => f.chefe.toLowerCase().includes(termo));
}
else if (tipo === "empresa") {
resultados = data.filter(f => f.empresa.toLowerCase().includes(termo));
}
else if (tipo === "setor") {
resultados = data.filter(f => f.setor.toLowerCase().includes(termo));
}
else if (tipo === "contagem") {
resultados = data.filter(f =>
f.setor.toLowerCase().includes(termo) ||
f.empresa.toLowerCase().includes(termo) ||
f.chefe.toLowerCase().includes(termo)
);
return respostaDiv.innerHTML =
`üìä Total encontrado para "<strong>${termo}</strong>": <strong>${resultados.length}</strong>`;
}
else {
resultados = data.filter(f => f.nome.toLowerCase().includes(termo));
}

if (!resultados.length)
return respostaDiv.innerHTML = "Nenhum registro encontrado.";

resultadosGlobais = resultados;
paginaAtual = 1;
renderizarPagina();
}

window.limpar = function() {
perguntaInput.value="";
respostaDiv.innerHTML="";
perguntaInput.focus();
}

});
</script>

</body>
</html>

