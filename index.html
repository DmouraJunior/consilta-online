<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sistema Integrado de Consulta de Servidores - DGF</title>

<style>
* { margin:0; padding:0; box-sizing:border-box; }
body { font-family:'Segoe UI', sans-serif; background:#f4f6f9; }

.topbar {
    background:#002b5c;
    color:white;
    padding:18px 30px;
    font-size:18px;
    font-weight:600;
}

.topbar small { display:block; font-size:12px; opacity:0.8; }
.gold-line { height:4px; background:#c9a227; }

.main {
    display:flex;
    justify-content:center;
    align-items:center;
    height:calc(100vh - 110px);
}

.container {
    background:white;
    padding:40px;
    border-radius:12px;
    width:460px;
    box-shadow:0 15px 40px rgba(0,0,0,0.1);
}

h2 { color:#002b5c; font-size:18px; margin-bottom:15px; }

input {
    width:100%;
    padding:12px;
    border-radius:6px;
    border:1px solid #ccc;
    margin-bottom:12px;
}

button {
    width:100%;
    padding:12px;
    border:none;
    border-radius:6px;
    background:#003366;
    color:white;
    font-weight:600;
    cursor:pointer;
    margin-bottom:8px;
}

button:hover { background:#002244; }
.secondary { background:#5c6f82; }
.secondary:hover { background:#4b5c6b; }
.logout { background:#8b0000; }
.logout:hover { background:#6e0000; }

.hidden { display:none; }

.response {
    margin-top:15px;
    background:#f1f3f6;
    padding:15px;
    border-radius:8px;
    min-height:60px;
    font-size:14px;
    border-left:4px solid #002b5c;
}

.footer {
    text-align:center;
    padding:15px;
    font-size:12px;
    background:#e9edf2;
}
</style>
</head>

<body>

<div class="topbar">
    Secretaria Estadual de Pernambuco - Diretoria Geral de FinanÃ§as
    <small>Sistema Interno Oficial</small>
</div>

<div class="gold-line"></div>

<div class="main">
<div class="container">

<div id="loginArea">
    <h2>Login</h2>
    <input type="text" id="usuario" placeholder="UsuÃ¡rio institucional">
    <input type="password" id="senha" placeholder="Senha">
    <button onclick="login()">Entrar</button>
</div>

<div id="sistemaArea" class="hidden">
    <h2>Assistente Inteligente</h2>
    <input type="text" id="pergunta" placeholder="Ex: Quem Ã© o chefe de Edson?">
    <button onclick="consultar()">Consultar</button>
    <button class="secondary" onclick="limpar()">Nova Consulta</button>
    <button class="logout" onclick="logout()">Encerrar SessÃ£o</button>
    <div class="response" id="resposta"></div>
</div>

</div>
</div>

<div class="footer">
Â© 2026 - Diretoria Geral de FinanÃ§as (DGF)
</div>

<script>
document.addEventListener("DOMContentLoaded", function() {

const WEBHOOK_URL = "https://script.google.com/macros/s/AKfycbxA3anDchuSGHN-E0d6dybvAEFI-NYWK1xIKSoz22Zd8CHpADzzNHfzvd_uvlqqigYZ/exec";
const TEMPO_EXPIRACAO = 30 * 60 * 1000;

const usuarios = [
    { usuario: "admin", senha: "1234" },
    { usuario: "rh", senha: "rh123" }
];

const loginArea = document.getElementById("loginArea");
const sistemaArea = document.getElementById("sistemaArea");
const usuarioInput = document.getElementById("usuario");
const senhaInput = document.getElementById("senha");
const perguntaInput = document.getElementById("pergunta");
const respostaDiv = document.getElementById("resposta");

function verificarSessao() {
    const tempoLogin = localStorage.getItem("tempoLogin");
    return tempoLogin && (Date.now() - parseInt(tempoLogin)) <= TEMPO_EXPIRACAO;
}

if (localStorage.getItem("logado") === "true" && verificarSessao()) {
    loginArea.classList.add("hidden");
    sistemaArea.classList.remove("hidden");
}

window.login = function() {
    const user = usuarioInput.value.trim();
    const pass = senhaInput.value.trim();
    const autorizado = usuarios.find(u => u.usuario === user && u.senha === pass);

    if (autorizado) {
        localStorage.setItem("logado", "true");
        localStorage.setItem("tempoLogin", Date.now());
        loginArea.classList.add("hidden");
        sistemaArea.classList.remove("hidden");
    } else {
        alert("UsuÃ¡rio ou senha invÃ¡lidos.");
    }
}

window.logout = function() {
    localStorage.clear();
    location.reload();
}

window.consultar = async function() {

    if (!verificarSessao()) {
        alert("SessÃ£o expirada.");
        logout();
        return;
    }

    let pergunta = perguntaInput.value.trim().toLowerCase();
    if (!pergunta) { respostaDiv.innerHTML="Digite uma pergunta."; return; }

    respostaDiv.innerHTML = "Consultando...";
    pergunta = pergunta.replace(/[?.,]/g, "");

    // Detecta o campo principal
    let campo = null;
    if (pergunta.includes("chefe")) campo = "chefe";
    if (pergunta.includes("empresa")) campo = "empresa";
    if (pergunta.includes("setor")) campo = "setor";
    if (pergunta.includes("cargo")) campo = "cargo";
    if (pergunta.includes("status")) campo = "status";

    // Detecta filtros
    let nome = null, filtroSetor=null, filtroEmpresa=null;

    if (pergunta.includes("mostrar todos do setor"))
        filtroSetor = pergunta.split("mostrar todos do setor")[1].trim();
    else if (pergunta.includes("mostrar todos da empresa"))
        filtroEmpresa = pergunta.split("mostrar todos da empresa")[1].trim();
    else if (pergunta.includes(" de "))
        nome = pergunta.split(" de ")[1].trim();
    else if (pergunta.includes(" do "))
        nome = pergunta.split(" do ")[1].trim();
    else if (pergunta.includes(" da "))
        nome = pergunta.split(" da ")[1].trim();
    else
        nome = pergunta;

    try {
        // Sempre puxa todos os registros do webhook
        const response = await fetch(WEBHOOK_URL + "?nome=");
        const data = await response.json();

        if (!data || data.length === 0) { respostaDiv.innerHTML="Nenhum registro encontrado."; return; }

        let resultados = data;

        // FILTROS LOCAIS
        if (nome && !filtroSetor && !filtroEmpresa)
            resultados = data.filter(f => f.nome.toLowerCase().includes(nome));

        if (filtroSetor)
            resultados = data.filter(f => f.setor.toLowerCase().includes(filtroSetor));

        if (filtroEmpresa)
            resultados = data.filter(f => f.empresa.toLowerCase().includes(filtroEmpresa));

        if (resultados.length === 0) { respostaDiv.innerHTML="Nenhum registro encontrado."; return; }

        // MONTAR RESPOSTA NATURAL
        let html = "";
        resultados.forEach(func => {
            if (campo && nome) {
                html += `O ${campo} de <strong>${func.nome}</strong> Ã© <strong>${func[campo]}</strong>.<br><br>`;
            } else {
                html += `<strong>${func.nome}</strong><br>
                    Setor: ${func.setor}<br>
                    Cargo: ${func.cargo}<br>
                    Chefe: ${func.chefe}<br>
                    Empresa: ${func.empresa}<br>
                    Status: ${func.status}<hr>`;
            }
        });

        respostaDiv.innerHTML = `ðŸ”Ž Encontrei ${resultados.length} resultado(s):<br><br>` + html;

    } catch (error) {
        respostaDiv.innerHTML="Erro ao consultar sistema.";
    }
}

window.limpar = function() {
    perguntaInput.value = "";
    respostaDiv.innerHTML = "";
}

});
</script>

</body>
</html>


