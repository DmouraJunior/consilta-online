<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sistema Inteligente DGF</title>

<style>
* { margin:0; padding:0; box-sizing:border-box; }

body {
    font-family: 'Segoe UI', sans-serif;
    background:#f4f6f9;
}

.topbar {
    background:#002b5c;
    color:#fff;
    padding:18px 30px;
    font-weight:600;
}

.gold-line { height:4px; background:#c9a227; }

.main {
    display:flex;
    justify-content:center;
    align-items:center;
    height:calc(100vh - 110px);
}

.container {
    background:#fff;
    padding:30px;
    border-radius:12px;
    width:500px;
    box-shadow:0 15px 40px rgba(0,0,0,0.1);
}

.logo {
    height:60px;
    display:block;
    margin:0 auto 10px;
}

h2 {
    text-align:center;
    color:#002b5c;
    margin-bottom:20px;
}

input {
    width:100%;
    padding:12px;
    border-radius:6px;
    border:1px solid #ccc;
    margin-bottom:10px;
}

button {
    width:100%;
    padding:12px;
    border:none;
    border-radius:6px;
    background:#003366;
    color:#fff;
    font-weight:600;
    cursor:pointer;
}

.chat {
    margin-top:15px;
    max-height:250px;
    overflow-y:auto;
    background:#f1f3f6;
    padding:10px;
    border-radius:8px;
}

.msg { margin-bottom:10px; }

.user { text-align:right; color:#003366; }
.bot { text-align:left; }

.footer {
    text-align:center;
    padding:10px;
    font-size:12px;
}
</style>
</head>

<body>

<div class="topbar">
Secretaria Estadual de Pernambuco - DGF
</div>
<div class="gold-line"></div>

<div class="main">
<div class="container">

<img src="brasao-dgf.png" class="logo">
<h2>Assistente Inteligente DGF</h2>

<input type="text" id="pergunta" placeholder="Ex: chefe e setor de edson">
<button onclick="consultar()">Perguntar</button>

<div class="chat" id="chat"></div>

</div>
</div>

<div class="footer">
Â© 2026 - DGF
</div>

<script>

const WEBHOOK_URL = "https://script.google.com/macros/s/AKfycbyA3fOOroxsfCTt1Ar_II3SZn_hHv-CLeP5Voiv5FPKOuGS4n330_f48A43lECINVc/exec";

const chatDiv = document.getElementById("chat");
const input = document.getElementById("pergunta");

input.addEventListener("keydown", e => {
if(e.key === "Enter") consultar();
});

// MEMÃ“RIA
let memoria = [];

// FUNÃ‡ÃƒO CHAT
function addMsg(texto, tipo){
let div = document.createElement("div");
div.className = "msg " + tipo;
div.innerHTML = texto;
chatDiv.appendChild(div);
chatDiv.scrollTop = chatDiv.scrollHeight;
}

// SIMILARIDADE
function similar(a,b){
let iguais=0;
for(let i=0;i<Math.min(a.length,b.length);i++){
if(a[i]===b[i]) iguais++;
}
return iguais/Math.max(a.length,b.length);
}

function acharPessoa(data, termo){
let melhor=null, score=0;

data.forEach(p=>{
let s = similar(p.nome.toLowerCase(), termo);
if(s>score){ score=s; melhor=p; }
});

return score>0.5 ? melhor : null;
}

// CONSULTA
async function consultar(){

let pergunta = input.value.toLowerCase().trim();
if(!pergunta) return;

addMsg(pergunta,"user");
input.value="";

const res = await fetch(WEBHOOK_URL);
const data = await res.json();

// IDENTIFICAR NOME
let termo = pergunta.split(" ").pop();
let pessoa = data.find(p=>p.nome.toLowerCase().includes(termo)) || acharPessoa(data, termo);

if(!pessoa){
addMsg("âŒ NÃ£o encontrei. Tente outro nome.","bot");
return;
}

// MEMORIZAR
memoria.push(pessoa);

// PERGUNTAS COMPOSTAS
let resposta = `ğŸ’¡ Sobre <strong>${pessoa.nome}</strong>:<br><br>`;

if(pergunta.includes("chefe"))
resposta += `ğŸ‘¨â€ğŸ’¼ Chefe: <strong>${pessoa.chefe}</strong><br>`;

if(pergunta.includes("setor"))
resposta += `ğŸ¢ Setor: <strong>${pessoa.setor}</strong><br>`;

if(pergunta.includes("empresa") || pergunta.includes("trabalha"))
resposta += `ğŸ¬ Empresa: <strong>${pessoa.empresa}</strong><br>`;

if(pergunta.includes("cargo"))
resposta += `ğŸ’¼ Cargo: <strong>${pessoa.cargo}</strong><br>`;

// SE NÃƒO ESPECIFICAR â†’ TUDO
if(resposta.includes("<br><br>") && resposta.split("<br>").length <= 3){
resposta += `
ğŸ‘¤ Nome: ${pessoa.nome}<br>
ğŸ¢ ${pessoa.setor}<br>
ğŸ’¼ ${pessoa.cargo}<br>
ğŸ‘¨â€ğŸ’¼ ${pessoa.chefe}<br>
ğŸ¬ ${pessoa.empresa}
`;
}

addMsg(resposta,"bot");

}

</script>

</body>
</html>

